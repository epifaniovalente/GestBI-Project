<!DOCTYPE html>
<html lang="pt-AO">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área Administrativa - Registo Civil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <!-- Sidebar / Navbar -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-900 text-white hidden md:flex flex-col">
            <div class="p-6 flex items-center gap-3 border-b border-gray-800">
                <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center font-bold">A</div>
                <span class="font-bold text-lg">Admin Panel</span>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="flex items-center gap-3 px-4 py-3 bg-gray-800 rounded-lg text-white">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    Dashboard
                </a>
                <a href="/" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    Voltar ao Site
                </a>
            </nav>
            <div class="p-4 border-t border-gray-800">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4"></i>
                    </div>
                    <div class="text-sm overflow-hidden">
                        <p id="admin-name-display" class="font-medium truncate">Administrador</p>
                        <p id="admin-email-display" class="text-gray-500 text-xs truncate">admin@registocivil.ao</p>
                    </div>
                </div>
                <button onclick="logout()" class="mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-900/50 hover:bg-red-900 text-red-200 rounded-lg text-xs transition-colors">
                    <i data-lucide="log-out" class="w-3 h-3"></i>
                    Terminar Sessão
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <!-- Mobile Header -->
            <header class="bg-white shadow-sm p-4 md:hidden flex justify-between items-center">
                <span class="font-bold text-gray-900">Admin Panel</span>
                <button onclick="logout()" class="text-red-600 text-sm font-medium">Sair</button>
            </header>

            <div class="p-8">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Gestão de Marcações</h1>
                        <p class="text-gray-600 mt-1">Visão geral dos agendamentos de BI.</p>
                    </div>
                    <button onclick="generateMockData()" class="text-sm text-blue-600 hover:underline">
                        Gerar Dados de Teste
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total de Marcações</p>
                                <h3 id="total-count" class="text-3xl font-bold text-gray-900 mt-2">0</h3>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <i data-lucide="users" class="w-6 h-6 text-blue-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Hoje</p>
                                <h3 id="today-count" class="text-3xl font-bold text-gray-900 mt-2">0</h3>
                            </div>
                            <div class="p-3 bg-green-50 rounded-lg">
                                <i data-lucide="calendar-check" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Pendentes</p>
                                <h3 class="text-3xl font-bold text-gray-900 mt-2">0</h3>
                            </div>
                            <div class="p-3 bg-orange-50 rounded-lg">
                                <i data-lucide="clock" class="w-6 h-6 text-orange-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters & Search -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row gap-4 justify-between items-center">
                        <h2 class="text-lg font-bold text-gray-900">Lista de Agendamentos</h2>
                        
                        <div class="flex gap-4 w-full md:w-auto">
                            <div class="relative flex-1 md:w-64">
                                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input 
                                    type="text" 
                                    id="search-input"
                                    placeholder="Pesquisar por nome ou ref..." 
                                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none text-sm"
                                >
                            </div>
                            <div class="relative">
                                <input 
                                    type="date" 
                                    id="date-filter"
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none text-sm text-gray-600"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider">
                                    <th class="px-6 py-4 font-medium">Referência</th>
                                    <th class="px-6 py-4 font-medium">Cidadão</th>
                                    <th class="px-6 py-4 font-medium">Data Agendada</th>
                                    <th class="px-6 py-4 font-medium">Hora</th>
                                    <th class="px-6 py-4 font-medium">Local</th>
                                    <th class="px-6 py-4 font-medium">Status</th>
                                </tr>
                            </thead>
                            <tbody id="appointments-table" class="divide-y divide-gray-200 text-sm text-gray-700">
                                <!-- Rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="empty-state" class="hidden p-12 text-center">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900">Nenhum agendamento encontrado</h3>
                        <p class="text-gray-500 mt-1">Tente ajustar os filtros ou gere dados de teste.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Verificar Autenticação
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = '/admin-login.html';
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminUser');
            window.location.href = '/admin-login.html';
        }

        lucide.createIcons();

        // Carregar info do admin
        const adminUser = JSON.parse(localStorage.getItem('adminUser') || '{"name": "Administrador", "email": "admin@registocivil.ao"}');
        document.getElementById('admin-name-display').textContent = adminUser.name;
        document.getElementById('admin-email-display').textContent = adminUser.email;

        // Elementos
        const tableBody = document.getElementById('appointments-table');
        const totalCountEl = document.getElementById('total-count');
        const todayCountEl = document.getElementById('today-count');
        const searchInput = document.getElementById('search-input');
        const dateFilter = document.getElementById('date-filter');
        const emptyState = document.getElementById('empty-state');

        // Carregar dados
        let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');

        // Função para renderizar tabela
        function renderTable(data) {
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');

            data.forEach(app => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="px-6 py-4 font-mono font-medium text-gray-900">${app.reference}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-bold text-gray-600">
                                ${app.name.charAt(0)}
                            </div>
                            ${app.name}
                        </div>
                    </td>
                    <td class="px-6 py-4">${app.date}</td>
                    <td class="px-6 py-4">${app.time}</td>
                    <td class="px-6 py-4 text-gray-500">${app.location}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Confirmado
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Função para atualizar estatísticas
        function updateStats() {
            totalCountEl.textContent = appointments.length;
            // Simulação simples de "hoje" (apenas conta total para demo)
            todayCountEl.textContent = Math.floor(appointments.length * 0.2); 
        }

        // Filtros
        function filterData() {
            const searchTerm = searchInput.value.toLowerCase();
            const filterDate = dateFilter.value; // YYYY-MM-DD

            const filtered = appointments.filter(app => {
                const matchesSearch = app.name.toLowerCase().includes(searchTerm) || 
                                      app.reference.toLowerCase().includes(searchTerm);
                
                // Nota: A data no objeto está formatada (ex: "Segunda-feira, 20..."). 
                // Para um filtro real de data, precisaríamos de guardar a data em formato ISO.
                // Aqui faremos uma verificação simples de string se houver filtro.
                let matchesDate = true;
                if (filterDate) {
                    // Converter input date para formato legível ou verificar se a string contém partes
                    // Simplificação para demo: verificar se a string de data contém o dia/mês
                    // Idealmente: guardar timestamp no objeto appointment
                    matchesDate = true; // Ignorar filtro de data complexo nesta demo HTML simples
                }

                return matchesSearch && matchesDate;
            });

            renderTable(filtered);
        }

        // Event Listeners
        searchInput.addEventListener('input', filterData);
        dateFilter.addEventListener('change', filterData);

        // Gerar dados Mock (para teste)
        window.generateMockData = function() {
            const mockData = [
                { reference: "REF-1023", name: "João Manuel", date: "Segunda-feira, 25 de Novembro de 2025", time: "09:00", location: "Loja do Kilamba" },
                { reference: "REF-4592", name: "Maria António", date: "Terça-feira, 26 de Novembro de 2025", time: "14:30", location: "Loja do Kilamba" },
                { reference: "REF-8821", name: "Pedro Costa", date: "Quarta-feira, 27 de Novembro de 2025", time: "10:00", location: "Loja do Kilamba" },
            ];
            
            const current = JSON.parse(localStorage.getItem('appointments') || '[]');
            const newApps = [...current, ...mockData];
            localStorage.setItem('appointments', JSON.stringify(newApps));
            appointments = newApps;
            renderTable(appointments);
            updateStats();
            alert("Dados de teste gerados!");
        };

        // Inicialização
        renderTable(appointments);
        updateStats();

    </script>
</body>
</html>
